8. 某系统有 R 1, R 2, R 3 共 3 种资源，在 T 0 时刻 P 1, P 2, P 3, P 4 这 4 个进程对资源的占用和需求如下，系统的可用资源向量为（2，1，2）

|   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|
|进程||最大需求|   ||占有量||
|R 1|R 2|R 3|R 1|R 2|R 3|
|P 1|3|2|2|1|0|0|
|P 2|6|1|3|4|1|1|
|P 3|3|1|4|2|1|1|
|P 4|4|2|2|0|0|2|

（1）将系统中各种资源的总和及此刻各进程对资源的需求数目用向量或矩阵表示出来。（2）如果此时 P 1 和 P 2 均发出资源请求向量（1，0，1），为了保持系统安全性，应如何分配资源给这两个进程。答：

（1）       各类资源总和: [R 1, R 2, R 3]=[ 9,3,6] 各进程对资源的需求数目: 

  2  2  2

  2  0  2

1  0  3 

4  2  0  

（2）       当将资源分配给 P 1 后，需求矩阵为：

1     2  1

2     0  2

1  0  3

4  2  0 

系统可利用资源为：1  1  1  故此时不存在安全序列，系统处于不安全状态，所以 P 1 进程的资源请求不能满足。

当将资源分配给 P 2 后，需求矩阵为：

2  2  2

1  0  1

1  0  3

4  2  0

系统可利用资源为：1  1  1 故此时存在安全序列 P 2, P 3, P 4, P 1，所以 P 2 进程的资源请求可以满足。

---
---

### 问题分析与解答

给定的条件：
- 资源类型：R 1, R 2, R 3（共三种资源）
- 系统的可用资源向量为：**[2, 1, 2]**
- 4 个进程对资源的最大需求和当前占有量如下表所示：

| 进程   | 最大需求 (R 1, R 2, R 3) | 占有量 (R 1, R 2, R 3) |
|--------|----------------------|-------------------|
| P 1     | 3, 2, 2               | 1, 0, 0           |
| P 2     | 6, 1, 3               | 4, 1, 1           |
| P 3     | 3, 1, 4               | 2, 1, 1           |
| P 4     | 4, 2, 2               | 0, 0, 2           |

### (1) 系统中各种资源的总和及此刻各进程对资源的需求数目

#### 资源总和

资源总和就是系统中每种资源的总量。可以通过每个进程的最大需求量和占有量来求得。

- **资源 R 1 总量**：  
  $\text{总需求} = 3 + 6 + 3 + 4 = 16$  
  $\text{总占有} = 1 + 4 + 2 + 0 = 7$  
  $\text{总量} = \text{总需求} = 16$ （因为总量就是最大需求量的上限）

- **资源 R 2 总量**：  
  $\text{总需求} = 2 + 1 + 1 + 2 = 6$  
  $\text{总占有} = 0 + 1 + 1 + 0 = 2$  
  $\text{总量} = 6$

- **资源 R 3 总量**：  
  $\text{总需求} = 2 + 3 + 4 + 2 = 11$  
  $\text{总占有} = 0 + 1 + 1 + 2 = 4$  
  $\text{总量} = 11$

因此，**系统中各种资源的总和**为：
$$
[R 1, R 2, R 3] = [9, 3, 6]
$$

#### 各进程对资源的需求数目

每个进程的需求数目是其最大需求减去已占有的资源量。可以通过以下公式计算：

- P 1 的需求：
  $$
  \text{需求} = \text{最大需求} - \text{占有量} = (3, 2, 2) - (1, 0, 0) = (2, 2, 2)
  $$

- P 2 的需求：
  $$
  \text{需求} = \text{最大需求} - \text{占有量} = (6, 1, 3) - (4, 1, 1) = (2, 0, 2)
  $$

- P 3 的需求：
  $$
  \text{需求} = \text{最大需求} - \text{占有量} = (3, 1, 4) - (2, 1, 1) = (1, 0, 3)
  $$

- P 4 的需求：
  $$
  \text{需求} = \text{最大需求} - \text{占有量} = (4, 2, 2) - (0, 0, 2) = (4, 2, 0)
  $$

所以，**各进程对资源的需求数目**的矩阵为：
$$
\begin{bmatrix}
2 & 2 & 2 \\
2 & 0 & 2 \\
1 & 0 & 3 \\
4 & 2 & 0
\end{bmatrix}
$$

---

### (2) 资源请求分配

#### 情况：P 1 和 P 2 向系统请求资源向量 (1, 0, 1)

我们需要首先分析分配资源后的系统状态，并验证系统是否处于安全状态。

##### 资源请求分配给 P 1

- P 1 请求的资源为 (1, 0, 1)。
- 在给 P 1 分配资源后，P 1 的占有量将变为：  
  $\text{新占有量} = (1 + 1, 0 + 0, 0 + 1) = (2, 0, 1)$
- P 1 的新需求将变为：  
  $\text{新需求} = (2 - 2, 2 - 0, 2 - 1) = (0, 2, 1)$

系统可用资源将变为：
- 可用资源 = 当前可用资源 - 分配给 P 1 的资源  
  $\text{新可用资源} = (2, 1, 2) - (1, 0, 1) = (1, 1, 1)$

#### 判断系统是否处于安全状态

在 P 1 请求资源后，系统的可用资源变为 (1, 1, 1)，我们需要判断是否存在一个安全序列，即进程能按顺序执行且不会发生死锁。

- **P 1**：需求 (0, 2, 1)，已占用 (2, 0, 1)，缺少 (0, 2, 1)。  
  可用资源为 (1, 1, 1)，不足以满足 P 1 的需求，因此系统进入不安全状态，无法满足 P 1 的请求。

##### 资源请求分配给 P 2

- P 2 请求的资源为 (1, 0, 1)。
- 在给 P 2 分配资源后，P 2 的占有量将变为：  
  $\text{新占有量} = (4 + 1, 1 + 0, 1 + 1) = (5, 1, 2)$
- P 2 的新需求将变为：  
  $\text{新需求} = (6 - 5, 1 - 1, 3 - 2) = (1, 0, 1)$

系统可用资源将变为：
- 可用资源 = 当前可用资源 - 分配给 P 2 的资源  
  $\text{新可用资源} = (2, 1, 2) - (1, 0, 1) = (1, 1, 1)$

#### 判断系统是否处于安全状态

- **P 2**：需求 (1, 0, 1)，已占用 (5, 1, 2)，缺少 (1, 0, 1)，系统可用资源满足 P 2 的需求，P 2 可以执行完毕并释放资源。
- **P 3**：P 3 的需求为 (1, 0, 3)，系统可以分配资源给 P 3，P 3 执行完毕并释放资源。
- **P 4**：P 4 的需求为 (4, 2, 0)，系统可以分配资源给 P 4，P 4 执行完毕并释放资源。
- **P 1**：P 1 执行完毕后，系统的可用资源恢复，可以满足 P 1 的需求。

因此，存在安全序列 **P 2 → P 3 → P 4 → P 1**，系统处于安全状态，P 2 的资源请求可以满足。

### 总结

1. **各类资源总和**：\([R 1, R 2, R 3] = [9, 3, 6]\)
2. **各进程的资源需求**：
$$
\begin{bmatrix}
2 & 2 & 2 \\
2 & 0 & 2 \\
1 & 0 & 3 \\
4 & 2 & 0
\end{bmatrix}
$$
3. **P 1 和 P 2 请求资源**：
   - P 1 的资源请求无法满足，系统进入不安全状态。
   - P 2 的资源请求可以满足，系统处于安全状态，安全序列为 P 2 → P 3 → P 4 → P 1。