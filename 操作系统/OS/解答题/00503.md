3. 有一矩阵 int` A[100][100]` ；以行为优先进行存储。计算机采用虚拟存储系统，物理内存共有 3 块，其中一块存放程序，其余两块存放数据。假设程序已在内存中占一块, 其余两块空闲。

|                                                                        |                                                                        |
| ---------------------------------------------------------------------- | ---------------------------------------------------------------------- |
| 程序 A:<br><br>for（ i=0; i<100;i++） for(j=0；j<100;j++)<br><br>`A[i][j]`=0; | 程序 B:<br><br>for（ j=0; j<100;j++） for(i=0；i<100;i++)<br><br>`A[i][j]`=0; |

若每块可存放 200 个整数，程序 A 和程序 B 的执行过程各会发生多少次缺页？若每页只能存放 100 个整数呢？以上说明了什么问题？答: (1) 每个主存块的大小可以存放 200 个数组元素，有两个内存块可以用来存放数组信息，数组中的元素按行编址。显然，对于程序 A，数组的存储顺序与访问顺序一致，每访问两行数组遇到一次缺页中断，共产生 50 次缺页中断；对于程序 B，数组的存储顺序（按行的顺序）与访问顺序（按列的顺序）不一致，每访问两个数组元素遇到一次缺页中断，共会产生5000 次缺页中断。

(2) 若每页只能存放 100 个整数，对于程序 A，数组的存储顺序与访问顺序一致，每访问一行数组遇到一次缺页中断，会产生 100 次缺页中断。对于程序 B，数组的存储顺序（按行的顺序）与访问顺序（按列的顺序）不一致，每访问一个数组元素遇到一次缺页中断，会产生

10000 次缺页中断。

以上结果说明：1. 缺页的次数与内存中数据存放的方式及程序的执行顺序有很大关系。

2. 当缺页中断的次数不多时，减小页面的大小对缺页次数的影响不大；但当缺页中断的次数很多时，减小页面的大小对缺页次数有很严重的影响。

---
---

在虚拟存储系统中，缺页中断（Page Fault）发生在程序访问的内存页不在主存时，需要从磁盘中加载对应的页到主存。缺页中断的次数受程序的数据访问模式（顺序）和内存的页面大小等因素的影响。通过本题中的程序 A 和程序 B，我们可以通过不同的页面大小来分析缺页中断次数的变化。

### 问题分析：

- **矩阵 `A[100][100]`** 表示一个 100 x 100 的二维数组，每个元素为 `int` 类型，假设每个 `int` 占 4 字节。
- 该数组有 100 x 100=10,000 个元素，总大小为 `10000 * 4 = 40,000` 字节。
- 在程序 A 和程序 B 中，内存存储顺序和访问顺序对缺页次数的影响是非常大的。

### 情境 1：每块内存可存放 200 个整数

- 每个内存块大小：200 个 `int`，即 `200 * 4 = 800` 字节。
- 数据矩阵 A 中的元素按行优先存储，这意味着 `A[0][0]`, `A[0][1]`, ..., `A[0][99] `被连续存储在内存中。每块可以容纳 200 个整数，所以 A 的每行需要占据两块内存（每行有 100 个整数）。一共需要 100 行，因此共有 50 个内存块用于存放数据。

#### 程序 A：

- **程序 A** 中，访问矩阵时，按行访问，即 `A[i][j]`。因为数组是按行存储的，程序 A 和数据存储顺序一致，所以每访问完两行就会发生一次缺页中断。
- 共有 100 行，每访问 2 行发生一次缺页中断，总共需要进行 50 次缺页中断。

#### 程序 B：

- **程序 B** 中，访问矩阵时，按列访问，即 `A[j][i]`。由于数组是按行存储的，而程序按列访问，这就导致每次访问一个元素都需要加载一个新的页（内存块）。由于每个内存块可以存储 200 个整数，程序 B 每访问 2 个整数（即两个元素在同一列中）就会导致缺页中断。
- 程序 B 总共需要访问 100 x 100=10,000 个元素，而每访问 2 个元素触发一次缺页中断，因此总共会发生 5000 次缺页中断。

### 情境 2：每页可存放 100 个整数

- 每页的大小：100 个 `int`，即 `100 * 4 = 400` 字节。
- 数据矩阵 A 中的元素按行优先存储，因此每行的 100 个元素需要占据一个内存页。

#### 程序 A：

- **程序 A** 中，访问矩阵时，按行访问。由于每行正好对应一个页，所以每访问一行就会发生一次缺页中断。
- 共有 100 行，每访问一行触发一次缺页中断，因此总共会发生 100 次缺页中断。

#### 程序 B：

- **程序 B** 中，访问矩阵时，按列访问。由于数据按行存储，而程序按列访问，每访问一个元素都需要加载一个新的页。程序 B 需要访问 100 x 100=10,000 个元素，每访问一个元素触发一次缺页中断，因此总共会发生 10,000 次缺页中断。

### 结果总结：

1. **每块存放 200 个整数：**
   - **程序 A** 的缺页中断次数：**50 次**
   - **程序 B** 的缺页中断次数：**5000 次**

2. **每页存放 100 个整数：**
   - **程序 A** 的缺页中断次数：**100 次**
   - **程序 B** 的缺页中断次数：**10,000 次**

### 分析与结论：

- **缺页次数与数据存储顺序及程序访问顺序的关系：**
  - 程序 A 按行访问数据，与内存中数据的行优先存储顺序一致，因此缺页中断次数较少。
  - 程序 B 按列访问数据，而内存中数据是按行存储的，这使得程序 B 在访问时频繁发生缺页中断，因为每次访问的数据块不连续。
  
- **页面大小对缺页次数的影响：**
  - 当每个页面较大时（如每块存放 200 个整数），程序 A 的缺页次数较少，因为程序 A 和数据存储顺序一致，访问时的数据能够尽可能地在一个页面内找到。
  - 当页面较小时（如每页存放 100 个整数），程序 B 的缺页次数大大增加，因为每访问一个元素就需要加载一个新的页面，造成了极高的缺页次数。

- **总结：**
  - 数据存储方式和程序的访问方式对缺页中断的次数有重要影响。
  - 在内存页较大时，程序的访问顺序和数据的存储顺序越一致，缺页中断次数就越少。
  - 当页面较小且程序的访问方式与存储方式不一致时，缺页中断的次数会显著增加。

这也突出了一个系统设计的要点：**内存页面的大小选择**与程序的访问模式之间的匹配性至关重要，合理的页面大小能够显著降低缺页中断的次数，提高程序的执行效率。